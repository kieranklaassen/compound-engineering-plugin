---
name: compound:configure
description: Interactive setup to customize which plugin bundles load into your context
---

# Configure Compound Engineering Plugin

This command customizes compound-engineering using a bundle-based system. Bundles group related components (agents, commands, skills) by workflow, making configuration intuitive and maintainable.

## How It Works

1. Loads bundle definitions from `bundles.json`
2. Asks questions for each configurable bundle
3. Resolves dependencies automatically (e.g., Frontend Design enables Browser Automation)
4. Saves preferences to `~/.claude/compound-engineering.config.json`
5. Rebuilds the installed plugin with only enabled bundles

## Prerequisites

1. The compound-engineering plugin is installed from a marketplace
2. The installed plugin has `bundles.json`, `_source/` directory, and `bin/build` script

## Step 1: Find the Installed Plugin

Read `~/.claude/plugins/installed_plugins.json` and find the compound-engineering entry.

Look in the `plugins` object for a key containing `compound-engineering` (e.g., `"compound-engineering@every-marketplace"`).

Extract the `installPath` value. Example:
```json
"compound-engineering@every-marketplace": [
  {
    "installPath": "/Users/username/.claude/plugins/cache/every-marketplace/compound-engineering/2.29.0"
  }
]
```

Save this path as `PLUGIN_PATH` for later steps.

**Verify build infrastructure exists:**
```bash
ls PLUGIN_PATH/bundles.json && ls PLUGIN_PATH/bin/build && ls -d PLUGIN_PATH/_source/
```

If any doesn't exist, tell the user:
> "Your installed version doesn't support bundle configuration. Please update the plugin."

Then stop.

## Step 2: Load Bundle Definitions

Read `PLUGIN_PATH/bundles.json` to get available bundles and their questions.

Parse the JSON and identify:
- **Always-on bundles**: `always_on: true` - these are always enabled, don't ask
- **Ask bundles**: `default: "ask"` - ask the user
- **Off-by-default bundles**: `default: false` - group into specialist question

## Step 3: Gather User Preferences

Use **AskUserQuestion** to ask bundle questions. Ask ONE question at a time.

### Language Bundles

**Question 1:** "Do you work with Ruby/Rails?"
- Header: "Ruby/Rails"
- Options: Yes / No

**Question 2:** "Do you write Ruby gems?"
- Header: "Ruby Gems"
- Options: Yes / No

**Question 3:** "Do you work with Python?"
- Header: "Python"
- Options: Yes / No

**Question 4:** "Do you work with TypeScript?"
- Header: "TypeScript"
- Options: Yes / No

### Workflow Bundles

**Question 5:** "Do you work with database migrations?"
- Header: "Migrations"
- Options: Yes / No

**Question 6:** "Need browser automation/testing?"
- Header: "Browser"
- Options: Yes / No

### Design Bundles (only if Browser = Yes)

If user answered Yes to browser automation:

**Question 7:** "Want frontend design iteration tools?"
- Header: "Frontend"
- Options: Yes / No

**Question 8:** "Do you use Figma?"
- Header: "Figma"
- Options: Yes / No

If user answered No to browser automation, skip questions 7-8 and set both to false.

### Specialist Bundles (Multi-select)

**Question 9:** "Enable any specialist tools?"
- Header: "Specialist"
- multiSelect: true
- Options:
  - "Agent-Native Development" - Building AI-native applications
  - "Plugin Development" - Developing Claude Code plugins
  - "Every.to Style" - Content writing for Every.to
  - "iOS/Xcode" - iOS and Xcode development

### Utilities Bundle

**Question 10:** "Enable utility tools? (image gen, cloud storage, etc.)"
- Header: "Utilities"
- Options: Yes / No

## Step 4: Build the Configuration JSON

Create the bundle config based on answers:

```json
{
  "$schema": "./compound.config.schema.json",
  "version": "2.0",
  "description": "Bundle configuration generated by /compound:configure",
  "bundles": {
    "ruby-rails": <answer from Q1>,
    "ruby-gems": <answer from Q2>,
    "python": <answer from Q3>,
    "typescript": <answer from Q4>,
    "data-migrations": <answer from Q5>,
    "browser-automation": <answer from Q6>,
    "frontend-design": <answer from Q7 or false if Q6 was No>,
    "figma": <answer from Q8 or false if Q6 was No>,
    "agent-native-dev": <true if selected in Q9>,
    "plugin-dev": <true if selected in Q9>,
    "every-style": <true if selected in Q9>,
    "ios-xcode": <true if selected in Q9>,
    "utilities": <answer from Q10>
  }
}
```

## Step 5: Save Configuration

Write the config to `~/.claude/compound-engineering.config.json`:

```bash
CONFIG_PATH="$HOME/.claude/compound-engineering.config.json"
```

Use the Write tool with the absolute path.

## Step 6: Copy Config to Plugin and Run Build

```bash
cp ~/.claude/compound-engineering.config.json PLUGIN_PATH/compound.config.json
cd PLUGIN_PATH && ./bin/build
```

Capture and display the build output, which will show:
- Dependency resolutions (if any)
- Enabled/disabled bundles
- Component counts

## Step 7: Write Version Marker

```bash
VERSION=$(grep -o '"version": *"[^"]*"' PLUGIN_PATH/.claude-plugin/plugin.json | head -1 | cut -d'"' -f4)
echo "$VERSION" > ~/.claude/compound-engineering.last-build-version
```

## Step 8: Summary

Tell the user:

```
Configuration complete!

Bundles enabled:
- Core (always on): workflows, research, code review, PR tools
- [List user-enabled bundles]

Bundles disabled:
- [List user-disabled bundles]

Dependencies auto-resolved:
- [List any auto-enabled bundles, e.g., "browser-automation (required by frontend-design)"]

Components: X agents, Y commands, Z skills

**Restart Claude Code to apply changes.**

To reconfigure: Run /compound:configure again
To restore all: Delete ~/.claude/compound-engineering.config.json and restart
```

## Bundle Reference

| Bundle | Components | Depends On |
|--------|------------|------------|
| **core** (always) | plan, review, work, compound, brainstorm commands + core research agents + compound-docs, brainstorming, git-worktree | - |
| **code-review** (always) | architecture, simplicity, patterns, performance, security reviewers | - |
| **research** (always) | best-practices, framework-docs, git-history, spec-flow + deepen-plan, plan_review | - |
| **pr-workflow** (always) | pr-comment-resolver + resolve commands, triage, changelog | - |
| **ruby-rails** | Rails reviewers, lint, Stimulus reviewer + dhh-rails-style | - |
| **ruby-gems** | ankane-readme-writer + andrew-kane-gem-writer | - |
| **python** | kieran-python-reviewer | - |
| **typescript** | kieran-typescript-reviewer | - |
| **data-migrations** | data-integrity, migration-expert, deployment-verification | - |
| **browser-automation** | bug-reproduction-validator + agent-browser + test-browser, reproduce-bug | - |
| **frontend-design** | design-iterator + frontend-design skill | browser-automation |
| **figma** | figma-design-sync, design-implementation-reviewer | browser-automation |
| **agent-native-dev** | agent-native-reviewer + architecture skill + audit command | - |
| **plugin-dev** | skill-creator, create-agent-skills + plugin commands | - |
| **every-style** | every-style-editor agent + skill | - |
| **ios-xcode** | xcode-test command | - |
| **utilities** | gemini-imagegen, rclone, file-todos, dspy-ruby + feature-video, lfg | - |
| **fork-tools** (always) | sync-reviewer + sync-upstream + configure | - |

## Error Handling

- **No bundles.json:** Plugin version doesn't support bundle configuration
- **Build fails:** Check Ruby is installed (`ruby --version`)
- **Dependency conflicts:** Build script auto-resolves, just inform user

## What Happens on Plugin Update

When the marketplace updates compound-engineering:
1. SessionStart hook runs `bin/auto-rebuild`
2. Script detects version change
3. Copies saved config from `~/.claude/compound-engineering.config.json`
4. Runs `bin/build` with bundle resolution
5. Updates version marker
6. New components in enabled bundles are automatically included
