---
name: compound:configure
description: Interactive setup to customize which plugin components load into your context
---

# Configure Compound Engineering Plugin

This command customizes compound-engineering to only load the components you need, reducing context window usage by 30-50%. Configuration persists across plugin updates.

## How It Works

1. Asks 5 questions about your workflow
2. Saves preferences to `~/.claude/compound-engineering.config.json`
3. Rebuilds the installed plugin in-place
4. On future plugin updates, auto-rebuilds with your saved preferences

## Prerequisites

This command requires:
1. The compound-engineering plugin is installed from a marketplace
2. The installed plugin has the `_source/` directory and `bin/build` script

## Step 1: Find the Installed Plugin

Read `~/.claude/plugins/installed_plugins.json` and find the compound-engineering entry.

Look in the `plugins` object for a key containing `compound-engineering` (e.g., `"compound-engineering@every-marketplace"`).

Extract the `installPath` value. Example:
```json
"compound-engineering@every-marketplace": [
  {
    "installPath": "/Users/username/.claude/plugins/cache/every-marketplace/compound-engineering/2.27.0"
  }
]
```

Save this path as `PLUGIN_PATH` for later steps.

**Verify build infrastructure exists:**
```bash
ls -la PLUGIN_PATH/bin/build && ls -d PLUGIN_PATH/_source/
```

If either doesn't exist, tell the user:
> "Your installed version doesn't support custom configuration. Please update the plugin or install from a marketplace that includes the configuration feature."

Then stop.

## Step 2: Gather User Preferences

Use **AskUserQuestion** to ask these questions ONE AT A TIME:

### Question 1: Primary Language
**Question:** "What is your primary programming language?"
**Options:**
- Ruby/Rails (Recommended for Rails developers)
- Python
- TypeScript/JavaScript
- Multiple languages (keep all reviewers)

### Question 2: Design Tools
**Question:** "Do you use Figma for design work?"
**Options:**
- Yes, I use Figma
- No, I don't use Figma

### Question 3: Browser Automation
**Question:** "Do you need browser automation capabilities?"
**Options:**
- Yes, for testing or automation
- No, I don't need browser automation

### Question 4: Image Generation
**Question:** "Do you need AI image generation (requires Gemini API key)?"
**Options:**
- Yes, I have a Gemini API key
- No, I don't need image generation

### Question 5: Content Editing
**Question:** "Do you write content that needs Every.to style guide compliance?"
**Options:**
- Yes, I write for Every.to
- No, I don't need Every style editing

## Step 3: Build the Configuration JSON

Start with this base config:

```json
{
  "$schema": "./compound.config.schema.json",
  "description": "Custom configuration generated by /compound:configure",
  "agents": {
    "enabled": ["*"],
    "disabled": []
  },
  "commands": {
    "enabled": ["*"],
    "disabled": ["xcode-test", "feature-video", "report-bug"]
  },
  "skills": {
    "enabled": ["*"],
    "disabled": []
  },
  "mcpServers": {
    "enabled": ["*"],
    "disabled": []
  }
}
```

**Add to disabled arrays based on answers:**

| Answer | Add to agents.disabled | Add to skills.disabled | Add to commands.disabled |
|--------|----------------------|----------------------|------------------------|
| Ruby/Rails | `kieran-python-reviewer`, `kieran-typescript-reviewer` | | |
| Python | `kieran-rails-reviewer`, `dhh-rails-reviewer`, `kieran-typescript-reviewer` | `dhh-rails-style`, `andrew-kane-gem-writer` | |
| TypeScript | `kieran-rails-reviewer`, `dhh-rails-reviewer`, `kieran-python-reviewer` | `dhh-rails-style`, `andrew-kane-gem-writer` | |
| No Figma | `figma-design-sync`, `design-implementation-reviewer`, `design-iterator` | | |
| No browser | | `agent-browser` | `test-browser` |
| No image gen | | `gemini-imagegen` | |
| No Every style | `every-style-editor` | `every-style-editor` | |

## Step 4: Save Configuration to User's Home Directory

Write the config JSON from Step 3 to `~/.claude/compound-engineering.config.json`:

```bash
# Get the absolute path
CONFIG_PATH="$HOME/.claude/compound-engineering.config.json"
```

Use the Write tool with the absolute path (e.g., `/Users/username/.claude/compound-engineering.config.json`).

## Step 5: Copy Config to Plugin and Run Build

Copy the config to the plugin directory and run the build:

```bash
cp ~/.claude/compound-engineering.config.json PLUGIN_PATH/compound.config.json
cd PLUGIN_PATH && ./bin/build
```

Note the output showing enabled/disabled counts.

## Step 6: Write Version Marker

Read the plugin version from `PLUGIN_PATH/.claude-plugin/plugin.json` and write it to the version marker file:

```bash
# Extract version and write to marker file
VERSION=$(grep -o '"version": *"[^"]*"' PLUGIN_PATH/.claude-plugin/plugin.json | head -1 | cut -d'"' -f4)
echo "$VERSION" > ~/.claude/compound-engineering.last-build-version
```

## Step 7: Summary

Tell the user:

```
Configuration complete!

Your preferences saved to: ~/.claude/compound-engineering.config.json

Components status:
- Agents: X enabled (Y disabled)
- Commands: X enabled (Y disabled)
- Skills: X enabled (Y disabled)

**Restart Claude Code to apply changes.**

Your preferences will automatically apply when the plugin updates.

To reconfigure:
- Run /compound:configure again

To restore full plugin:
- Delete ~/.claude/compound-engineering.config.json
- Delete ~/.claude/compound-engineering.last-build-version
- Restart Claude Code (plugin will rebuild with all components)
```

## Error Handling

- **No bin/build:** Plugin version doesn't support configuration
- **Build fails:** Check Ruby is installed (`ruby --version`)
- **Permission denied:** Check file permissions

## What Happens on Plugin Update

When the marketplace updates compound-engineering:
1. SessionStart hook runs `bin/auto-rebuild`
2. Script detects version change (compares plugin.json to last-build-version)
3. Copies saved config from `~/.claude/compound-engineering.config.json`
4. Runs `bin/build` to apply preferences
5. Updates version marker

This is automatic - no user action needed.
